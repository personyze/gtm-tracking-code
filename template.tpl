___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.

___INFO___

{
  "displayName": "Personyze Tracking",
  "description": "Enables website personalization with www.personyze.com which combines product recommendations, recommendations by email, behavioral targeting and A/B testing.",
  "categories": ["PERSONALIZATION", "EMAIL_MARKETING", "EXPERIMENTATION"],
  "securityGroups": [],
  "id": "cvt_temp_public_id",
  "type": "TAG",
  "version": 1,
  "brand": {
    "thumbnail": "data:image/png;base64,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",
    "displayName": "",
    "id": "brand_dummy"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "help": "Get this number from the Personyze web site",
    "valueValidators": [
      {
        "type": "NUMBER"
      },
      {
        "type": "NON_EMPTY"
      }
    ],
    "displayName": "Account Number",
    "simpleValueType": true,
    "name": "aid",
    "type": "TEXT"
  },
  {
    "help": "Space separated list of domains you want to track, like example.com site.com",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "displayName": "For use on domains",
    "simpleValueType": true,
    "name": "d",
    "type": "TEXT"
  }
]


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_S_T.setup"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://counter.personyze.com/stat-track-lib.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const queryPermission = require('queryPermission');
const callInWindow = require('callInWindow');
const logToConsole = require('logToConsole');

const url = 'https://counter.personyze.com/stat-track-lib.js';

if (queryPermission('inject_script', url))
{	injectScript
	(	url,
     	() =>
     	{	callInWindow('_S_T.setup', data.aid, data.d);
         	data.gtmOnSuccess();
        },
     	() =>
     	{	logToConsole("Couldn't load "+url);
         	data.gtmOnFailure();
        }
    );
}


___NOTES___

Created on 8/14/2019, 2:18:19 AM
